{% load static %}

<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.lordicon.com/lordicon.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap">
    <link rel="stylesheet" href="{% static 'Box.css' %}" >
    <link rel="stylesheet" href="{% static 'lightHome.css' %}">
    <title>‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</title>
</head>

<body>

    <div class="container">

        <div class="head">
            <h1>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏¢‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h1>
            <h2>‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏•‡∏≥‡∏û‡∏π‡∏ô</h2>
        </div>

        <div class="beforeTable">
            <h2 class = "statusSentence">‡πÅ‡∏ñ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</h2>
            <div class="statusBox">
                <div class="plan" style="width: {{ percents.0 }}%"></div>
                <div class="permit" style="width: {{ percents.1 }}%"></div>
                <div class="process" style="width: {{ percents.2 }}%"></div>
                <div class="finish" style="width: {{ percents.3 }}%"></div>
            </div>                      
            <div class="labelStatus">
                <div>üî¥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ {{ percents.0 }}% </div>
                <div>üü† ‡∏Ç‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ {{ percents.1 }}% </div>
                <div>üü° ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô {{ percents.2 }}% </div>
                <div>üü¢ ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß {{ percents.3 }}% </div>
            </div>
        </div>

        <div class="infomationBar">
            <div class="dowloadForm">
                <button onclick="dowloadForm('form1')">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡πà‡∏≤‡∏á‡πÜ</button>
                <button onclick="dowloadForm('form2')">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏ö‡∏¥‡∏Å‡∏û‡∏±‡∏™‡∏î‡∏∏</button>
                <button onclick="dowloadForm('form3')">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</button>
            </div>
            <div class="loadAndSearch">
                <form action="{% url 'search_view' %}" method="get">
                    <label class="findProject">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</label>
                    <input name="search" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£" class="searchInput" value="{{ query }}">
                    <button type="submit" class="findButton">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                </form>
                <button class="downloadFile" onclick="loadExel()">‡∏î‡∏≤‡∏ß‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>
        </div>

        <div class="buttonRightTop">
            <button class="adminButton" onclick="redirectToAdmin()">
                <lord-icon src="https://cdn.lordicon.com/kthelypq.json" trigger="hover"></lord-icon>
            </button>
        </div>

        <table class="project-table">
            <caption>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</caption>
            <caption class="showTotal" 
                    style="color: gray;">
                    {% if query %}
                        ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 
                        <span id="projectCount">{{ result|length }}</span> ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
                    {% else %}
                        ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 
                        <span id="projectCount">{{ mymembers|length }}</span> ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
                    {% endif %}
            </caption>
            <thead>
                <tr>
                    <th style="text-align: center;">‡∏£‡∏´‡∏±‡∏™‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</th>
                    <th>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</th>
                    <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    <th style="text-align: center;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                </tr>
            </thead>
            <tbody>
                {% if query %}
                    {% for member in result %}
                    <tr>
                        <td style="text-align: center;">{{ member.code }}</td>
                        <td>{{ member.color }} {{ member.projectName }}</td>
                        <td>{{ member.agency }}</td>
                        <td>{{ member.status }}</td>
                        <td><button  style="background-color: #3937bd; color: white;" class="finance" onclick="openFinanceModal(parseInt('{{ member.id }}'))">‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</button></td>
                    </tr>                
                    {% endfor %}
                {% elif mymembers%}
                    {% for member in mymembers %}
                    <tr>
                        <td style="text-align: center;">{{ member.code }}</td>
                        <td>{{ member.color }} {{ member.projectName }}</td>
                        <td>{{ member.agency }}</td>
                        <td>{{ member.status }}</td>
                        <td><button  style="background-color: #3937bd; color: white;" class="finance" onclick="openFinanceModal(parseInt('{{ member.id }}'))">‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</button></td>
                    </tr>                
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="5" style="text-align: center;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    
    <script src="{% static 'js/function.js' %}"></script>

</body>

<div id="financeModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeFinanceModal()">&times;</span>
        <h2>‡∏¢‡∏≠‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ : <span id="projectValue"></span> ‡∏ö‡∏≤‡∏ó</h2>
        <div class="chart-container"><canvas id="pieChart"></canvas></div>
    </div>
</div>

</html>